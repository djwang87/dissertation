Sensitivity to mispronunciations
=======================================================================

```{r setup, include = FALSE}
knitr::read_chunk("./helpers.R")
if (interactive()) source("./helpers.R")
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

```{r helpers, message = FALSE, warning = FALSE}
```

```{r plotting-helpers, include = FALSE}
# knitr::opts_chunk$set(cache = TRUE)
constants$cap_emp_and_sim <- 
  "Points: Emprical means ± SE.
Ribbons: Mean ± 95% CI for 1000 simulated children."
constants$cap_emp_and_draw <- 
  "Intervals: Empirical mean ± SE. Lines: 100 posterior means."

library(bayesplot)
theme_set(theme_teej())
```

```{r load, include = FALSE}
d_raw <- readr::read_csv("./data/aim2-model-ready.csv.gz")

d <- d_raw %>% 
  select(-starts_with("ot")) %>% 
  filter(Condition == "MP", !is.na(Bias_Fam), 300 <= Time) %>% 
  mutate(Trials = Target + Distractor) %>% 
  polypoly::poly_add_columns(
    Time, degree = 3, scale_width = 1, prefix = "ot")

study_child_with_empty_cells <- d %>% 
  filter(Trials < 4) %>% 
  distinct(Study, ResearchID, Bias_Fam)

study_counts <- study_child_with_empty_cells %>%
  count(Study, Bias_Fam) %>% 
  tidyr::complete(Bias_Fam, Study, fill = list(n = 0))

study_counts_f <- study_counts %>%
  filter(Bias_Fam == "Familiar") %>% 
  split(.$Study) %>%
  lapply(pull, n) %>%
  set_names(stringr::str_replace, "TimePoint", "T")

noun_f_t1 <- ngettext(study_counts_f$T1, "child", "children")

study_counts_u <- study_counts %>%
  filter(Bias_Fam == "Unfamiliar") %>% 
  split(.$Study) %>%
  lapply(pull, n) %>%
  set_names(stringr::str_replace, "TimePoint", "T")

d <- d %>% 
  anti_join(study_child_with_empty_cells)

d_u <- d %>% filter(Bias_Fam == "Unfamiliar")
d_f <- d %>% filter(Bias_Fam == "Familiar")

readr::write_csv(d_u, "./data/aim2-mp-unfam-modeled-data.csv.gz")
readr::write_csv(d_f, "./data/aim2-mp-fam-modeled-data.csv.gz")

library(brms)
mp_unfam <- readr::read_rds("./data/aim2-mp-unfam.rds.gz")
mp_unfam

mp_fam <- readr::read_rds("data/aim2-mp-fam.rds.gz")
mp_fam

unfam_peaks <- readr::read_csv("./data/aim2-mp-unfam-peaks.csv.gz")
fam_peaks <- readr::read_csv("./data/aim2-mp-fam-peaks.csv.gz")
```

For the mispronunciation trials, there is no correct "target", as there
is for real word or nonword trials. The design of the task allows
the child to associate the mispronunciation with a unfamiliar object or
with a familiar object with phonologically similar name. As a result,
there are not any "distractor-initial" trials, so I analyzed the
mispronunciation trials separately for both initial-fixation locations.
One model handled trials where a child's gaze started on the familiar object
and another model handled trials starting on the unfamiliar object. For
these models, I fit a growth curve model that included indicators for
Age and Time × Age interactions, as in the model from
[Chapter \@ref(fam-rec)](#fam-rec). The basic model was therefore:

`r insert_html_math()`
\small
\begin{align*}
   \text{log-odds}(\mathit{looking\,}) =\
    &\beta_0 + 
      \beta_1\text{Time}^1 + 
      \beta_2\text{Time}^2 + 
      \beta_3\text{Time}^3\ + 
      &\text{[age 3 growth curve]} \\
    (&\gamma_{0} + 
      \gamma_{1}\text{Time}^1 + 
      \gamma_{2}\text{Time}^2 +
      \gamma_{3}\text{Time}^3)*\text{Age}\,\text{4} + \
      &\text{[adjustments for age 4]} \\
    (&\delta_{0}\!\ + 
      \delta_{1}\text{Time}^1\!\ + 
      \delta_{2}\text{Time}^2\!\ +
      \delta_{3}\text{Time}^3)*\text{Age}\,\text{5} \
      &\text{[adjustments for age 5]} \\
\end{align*}
`r insert_html_math()`

[Appendix \@ref(aim2-gca-models)](#aim2-gca-models) contains the R code
used to fit these models along with a description of the specifications
represented by the model syntax. The mixed effects model included
by-child and by-child-by-age random effects so that it could capture how
a child's growth curve features may be similar over developmental time
(by-child effects) and may differ at each age (by-child-by-age effects).

For these analyses, I modeled the data from `r min(d$Time)`
to `r max(d$Time)` ms after target onset. As in the real word vs.
nonword analyses, I removed any Age × Child levels if the child's data
had fewer than 4 fixations in a single time bin. As a result, children
had to have at least 4 looks to one of the two images in every 50 ms
time bin. For the familiar-initial trials, this screening removed
`r study_counts_f$T1` `r noun_f_t1` at age 3, `r study_counts_f$T2` at
age 4, and `r study_counts_f$T3` at age 5, and for the
unfamiliar-initial trials, this screening removed `r study_counts_u$T1`,
`r study_counts_u$T2`, and `r study_counts_u$T3` children at ages 3, 4,
and 5, respectively.



## Unfamiliar-initial trials





```{r unfam-model}
test <- posterior_samples(mp_unfam, pars = "^b_") %>% 
  mutate(
    b_Intercept_Age3 = b_Intercept,
    b_Intercept_Age4 = b_Intercept + b_StudyTimePoint2,
    b_Intercept_Age5 = b_Intercept + b_StudyTimePoint3,
    b_ot1_Age3 = b_ot1,
    b_ot1_Age4 = b_ot1 + `b_ot1:StudyTimePoint2`,
    b_ot1_Age5 = b_ot1 + `b_ot1:StudyTimePoint3`,
    b_ot2_Age3 = b_ot2,
    b_ot2_Age4 = b_ot2 + `b_ot2:StudyTimePoint2`,
    b_ot2_Age5 = b_ot2 + `b_ot2:StudyTimePoint3`,
    b_ot3_Age3 = b_ot3,
    b_ot3_Age4 = b_ot3 + `b_ot3:StudyTimePoint2`,
    b_ot3_Age5 = b_ot3 + `b_ot3:StudyTimePoint3`,
    b_Intercept_Prop_Age3 = plogis(b_Intercept_Age3),
    b_Intercept_Prop_Age4 = plogis(b_Intercept_Age4),
    b_Intercept_Prop_Age5 = plogis(b_Intercept_Age5),
    d_Intercept_Age4 = b_Intercept_Age4 - b_Intercept_Age3,
    d_Intercept_Age5 = b_Intercept_Age5 - b_Intercept_Age4,
    d_Intercept_Prop_Age4 = b_Intercept_Prop_Age4 - b_Intercept_Prop_Age3,
    d_Intercept_Prop_Age5 = b_Intercept_Prop_Age5 - b_Intercept_Prop_Age4,
    d_Intercept_Prop_Age5_3 = b_Intercept_Prop_Age5 - b_Intercept_Prop_Age3,
    d_ot1_Age4 = b_ot1_Age4 - b_ot1_Age3,
    d_ot1_Age5 = b_ot1_Age5 - b_ot1_Age4,
    d_ot2_Age4 = b_ot2_Age4 - b_ot2_Age3,
    d_ot2_Age5 = b_ot2_Age5 - b_ot2_Age4,
    d_ot3_Age4 = b_ot3_Age4 - b_ot3_Age3,
    d_ot3_Age5 = b_ot3_Age5 - b_ot3_Age4)

unfam_peaks <- readr::read_csv("./data/aim2-mp-unfam-peaks.csv.gz")

group_average_peaks <- unfam_peaks %>%
  mutate(
    Study = convert_study_to_age(Study),
    Peak = plogis(med)) %>%
  group_by(Study, .draw) %>%
  summarise_at(vars(Peak), mean, na.rm = TRUE) %>% 
  ungroup() %>% 
  tidyr::spread(Study, Peak) %>% 
  select(-.draw) %>% 
  mutate(d_43 = `Age 4` - `Age 3`, d_54 = `Age 5` - `Age 4`) %>% 
  mcmc_intervals_data()

group_peaks <- group_average_peaks %>% 
  split(.$parameter) %>% 
  lapply(pull, m) %>% 
  lapply(printy::fmt_fix_digits, 2) %>% 
  lapply(printy::fmt_leading_zero)

unfam_ceilings <- unfam_peaks %>%
  mutate(
    Study = convert_study_to_age(Study),
    Peak = plogis(med)) %>%
  group_by(Study, .draw) %>% 
  summarise(Ceiling = sum(Peak >= .99)) %>% 
  ungroup() %>% 
  select(Study, Ceiling) %>%
  tidyr::nest(-Study) %>% 
  mutate(intervals = data %>% purrr::map(bayesplot::mcmc_intervals_data)) %>% 
  select(-data) %>% 
  tidyr::unnest(intervals) %>% 
  mutate(
    Study = stringr::str_replace(Study, "TimePoint", "TP"),
    parameter = stringr::str_replace(parameter, "nonsense", "nons"))

ceilings <- unfam_ceilings  %>% 
  split(.$Study) %>% 
  fmt_inline_median_interval(0) %>% 
  add_ui_slug_to_first(slug = "90%&nbsp;UI: ")


i_ints <- mcmc_intervals_data(test, regex_pars = "Prop_Age") %>% 
  split(.$parameter) %>% 
  fmt_inline_median_interval() %>% 
  add_ui_slug_to_first("90% UI: ") %>% 
  lapply(stringr::str_replace_all, "0[.]", ".")
```


```{r explore-intervals, eval = FALSE}
test <- posterior_samples(mp_unfam, pars = "^b_") %>% 
  mutate(
    b_Intercept_Age3 = b_Intercept,
    b_Intercept_Age4 = b_Intercept + b_StudyTimePoint2,
    b_Intercept_Age5 = b_Intercept + b_StudyTimePoint3,
    b_ot1_Age3 = b_ot1,
    b_ot1_Age4 = b_ot1 + `b_ot1:StudyTimePoint2`,
    b_ot1_Age5 = b_ot1 + `b_ot1:StudyTimePoint3`,
    b_ot2_Age3 = b_ot2,
    b_ot2_Age4 = b_ot2 + `b_ot2:StudyTimePoint2`,
    b_ot2_Age5 = b_ot2 + `b_ot2:StudyTimePoint3`,
    b_ot3_Age3 = b_ot3,
    b_ot3_Age4 = b_ot3 + `b_ot3:StudyTimePoint2`,
    b_ot3_Age5 = b_ot3 + `b_ot3:StudyTimePoint3`,
    b_Intercept_Prop_Age3 = plogis(b_Intercept_Age3),
    b_Intercept_Prop_Age4 = plogis(b_Intercept_Age4),
    b_Intercept_Prop_Age5 = plogis(b_Intercept_Age5),
    d_Intercept_Age4 = b_Intercept_Age4 - b_Intercept_Age3,
    d_Intercept_Age5 = b_Intercept_Age5 - b_Intercept_Age4,
    d_Intercept_Prop_Age4 = b_Intercept_Prop_Age4 - b_Intercept_Prop_Age3,
    d_Intercept_Prop_Age5 = b_Intercept_Prop_Age5 - b_Intercept_Prop_Age4,
    d_Intercept_Prop_Age5_3 = b_Intercept_Prop_Age5 - b_Intercept_Prop_Age3,
    d_ot1_Age4 = b_ot1_Age4 - b_ot1_Age3,
    d_ot1_Age5 = b_ot1_Age5 - b_ot1_Age4,
    d_ot2_Age4 = b_ot2_Age4 - b_ot2_Age3,
    d_ot2_Age5 = b_ot2_Age5 - b_ot2_Age4,
    d_ot3_Age4 = b_ot3_Age4 - b_ot3_Age3,
    d_ot3_Age5 = b_ot3_Age5 - b_ot3_Age4)

mcmc_intervals(test, regex_pars = "Intercept_A")
mcmc_intervals(test, regex_pars = "Intercept_Prop")
mcmc_intervals(test, regex_pars = "ot1_Age")
mcmc_intervals(test, regex_pars = "ot2_Age")
mcmc_intervals(test, regex_pars = "ot3_Age")
mcmc_intervals(test, regex_pars = "Intercept_Prop")
mcmc_intervals(test, regex_pars = "Age")
```


When children start on the image of a novel object and hear a
mispronunciation, they look to the familiar image.
Figure \@ref(fig:unfam-initial-mp-trials) shows the average of
children's growth curves along with the 100 model-estimated group
averages. The growth curves all cross the .5 threshold, so that the
children on average looked more to the familiar than the unfamiliar
image. Granted, the degree of referent selection is not as great as
that observed for the real words or nonwords. For those conditions, the
average growth curves reached a peak of around .77 at age 3 whereas for
the mispronunciations the age-3 peak is around .62. Children were slower
to process mispronunciations. For the real-word condition, the average
age 3 growth curve crosses .5 looking probability around 775 ms after
target onset whereas in the mispronunciation condition, this threshold
is crossed at 1000 ms. Children associate the mispronunciation with the
familiar object, although they are slower and show greater uncertainty
compared to real word trials.

(ref:unfam-initial-mp-trials) Averages of participants' growth curves in each age. The lines represent 100 posterior predictions of the group average. 

```{r unfam-initial-mp-trials, fig.cap = "(ref:unfam-initial-mp-trials)", fig.width = 4.5, fig.height = 3.5, out.width = "50%"}
newdata <- d_u %>% 
  distinct(Study, ResearchID, Time, ot1, ot2, ot3) %>% 
  mutate(Target = 0, Trials = 30)

m_u_new_fits_each <- augment_linpred(
  mp_unfam, newdata, nsamples = 100, allow_new_levels = TRUE) %>% 
  mutate(Study = convert_study_to_age(Study)) 

m_u_new_fits <- m_u_new_fits_each %>% 
  group_by(Study, .draw, Time) %>% 
  summarise(Prop = mean(plogis(.posterior_value))) %>% 
  group_by(Study, .draw)

df_u_label <- tibble::tribble(
  ~Study, ~Time, ~Prop,
  "Age 3", 1050, .42,
  # "Age 4", 1000, .42,
  "Age 5", 1300, .72)

d_u_plotting <- d_u %>% 
  mutate(Study = convert_study_to_age(Study)) 

ggplot(d_u_plotting) + 
  aes(x = Time, y = Prop, color = Study) + 
  geom_hline(yintercept = .5, size = 2, color = "white") +
  stat_summary(fun.data = mean_se, geom = "pointrange") + 
  geom_line(aes(group = .group), data = m_u_new_fits, alpha = .05) +
  geom_text(
    aes(label = Study),
    data = df_u_label,
    size = 5, 
    family = "Lato Semibold") +
  geom_text(
    aes(label = label),
    data = data_frame(
      Time = 425, 
      Prop = .11, 
      label = constants$note_mp_unfam),
    size = 3, 
    hjust = 0,
    color = constants$col_off_black,
    family = "Lato") +
  scale_color_study() + 
  expand_limits(y = .76) +
  guides(color = FALSE) +
  labs(
    x = constants$x_time,
    y = constants$y_prop_fam,
    caption = constants$cap_emp_and_draw)
```

Of the growth curve features, developmental changes were only observed
for the average probability (intercept) and peak probability features. At age 3, the average
proportion of looks to the familiar image was
`r i_ints$b_Intercept_Prop_Age3`. The looking proportion increased by
`r i_ints$d_Intercept_Prop_Age4` to `r i_ints$b_Intercept_Prop_Age4` at
age 4. This year-over-year change is probably positive, but a change
of 0 is still a plausible result. Visually, this uncertainty appears in
the growth curve plot by how close together the age-3 and age-4 growth
curves appear. The average proportion of looks increased by
`r i_ints$d_Intercept_Prop_Age5` to `r i_ints$b_Intercept_Prop_Age5` at
age 5. Here, there is more certainty that the year-over-year change was
positive. In short, performance was similar for age 3 and age 4 but
there was a marked improvement at age 5.

Figure \@ref(fig:unfam-peaks-by-age) shows participant's growth curve
peaks for each year of the study. There were computed as in other
chapters by taking the median of the five highest values on a growth
curve. The average of the participants' growth curve peaks followed the
same pattern as the intercept: similar levels at age 3 and age 4
(`r group_peaks[["Age 3"]]` versus `r group_peaks[["Age 4"]]`) but a
clear gain in looking peak probability at age 5
(`r group_peaks[["Age 5"]]`). The bottom hinge of the boxplots in
Figure \@ref(fig:unfam-peaks-by-age) mark the location of the 25th
percentile. Thus, at age 3, approximately 75% of children were at or
above the .5 threshold. Unlike the nonword conditions, very few
listeners achieve a peak of looking probability of .99: At age 5, only
`r ceilings[["Age 5"]]` children reached ceiling performance.

(ref:unfam-peaks-by-age) Growth curve peaks by age for mispronunciation trials starting on the unfamiliar image.

```{r unfam-peaks-by-age, fig.cap = "(ref:unfam-peaks-by-age)", fig.width=4, fig.height=3, out.width="50%"}
study_peak_counts <- unfam_peaks %>%
  distinct(Study, ResearchID) %>%
  mutate(
    Study = Study %>% convert_study_to_age(),
    StudyCounts = Study %>% fct_add_counts()) %>%
  distinct(Study, StudyCounts)

x_levels <- setNames(
  as.character(study_peak_counts$StudyCounts), 
  as.character(study_peak_counts$Study))


unfam_peaks %>% 
  mutate(
    Study = convert_study_to_age(Study),
    Peak = plogis(med)) %>% 
  group_by(Study, ResearchID) %>% 
  summarise_at(vars(Time, Peak), mean, na.rm = TRUE) %>% 
  ggplot() + 
    aes(x = Study, y = Peak) + 
    geom_hline(yintercept = .5, size = 2, color = "white") + 
    geom_boxplot(width = .4, fill = NA, outlier.alpha = 0) +
    geom_point(
      position = position_jitter(width = .2), 
      alpha = .4, 
      shape = 1) + 
    # geom_text(
    #   aes(label = label),
    #   data = data_frame(
    #     Peak = 1.04, 
    #     label = constants$note_mp_unfam,
    #     Study = "Age 3"), 
    #   hjust = .1,
    #   # position = position_dodge(width = 1.15), 
    #   size = 3, 
    #   family = "Lato") +
    labs(
      title = "Growth curve peaks",
      subtitle = constants$note_mp_unfam,
      x = NULL,
      y = NULL,
      caption = "Points: Participant posterior means.") + 
    scale_x_discrete(labels = x_levels) +
    theme(plot.subtitle = element_text(size = rel(.9)))
```

None of the other growth curve features showed developmental changes.
That is, there were no credible year-over-year changes for the linear,
quadratic or cubic time components of the growth curve. Although
Figure \@ref(fig:unfam-initial-mp-trials) shows children's probability
of looking to the familiar image increasing more quickly at age 5, this
effect cannot be clear tied to any of the model's polynomial time
features. After about 600 ms, the age 5 curve is almost parallel to
other curves. This visual feature is consistent with the intercept
effect: The curve is higher than the others on average, but it does not
show any differences in shape.


```{r, include = FALSE}
scores <- readr::read_csv("./data-raw/test_scores.csv") %>% 
  mutate(
    MinPair_ProportionCorrect = ifelse(
      MinPair_ProportionCorrect < .2, NA, MinPair_ProportionCorrect),
    Study = convert_study_to_age(Study))

tp1 <- scores %>% filter(Study == "Age 3")
tp2 <- scores %>% filter(Study == "Age 4")
tp3 <- scores %>% filter(Study == "Age 5")

# ppvt <- readr::read_csv(file = "./data-raw/test_scores.csv") %>%
#   # filter(Study == "TimePoint1") %>%
#   select(Study, ResearchID, PPVT_Age, PPVT_GSV, EVT_Age, PPVT_GSV)
# 
# minp <- readr::read_csv(file = "./data-raw/age3-minpair-fits.csv") %>%
#   filter(Model == "base + age + ppvt") %>%
#   mutate(Study = "TimePoint1") 

unfam_peaks_avgs <- unfam_peaks %>% 
  mutate(
    Study = convert_study_to_age(Study),
    Peak = plogis(med)) %>% 
  group_by(Study, ResearchID) %>% 
  summarise_at(vars(Time, Peak), mean, na.rm = TRUE) %>% 
  ungroup() 

minp_cors <- unfam_peaks %>% 
  mutate(
    Study = convert_study_to_age(Study),
    Peak = plogis(med)) %>% 
  filter(Study == "Age 3") %>% 
  left_join(tp1) %>% 
  group_by(.draw) %>%  
  tidy_correlation(Peak, MinPair_ProportionCorrect) 

min_p_cor <- minp_cors %>% 
  filter(column1 == "Peak", column2 == "MinPair_ProportionCorrect") %>% 
  select(MinP = estimate) %>% 
  mcmc_intervals_data() %>% 
    split(.$parameter) %>% 
  fmt_inline_median_interval() %>% 
  add_ui_slug_to_first("90% UI: ") %>% 
  lapply(stringr::str_replace_all, "0[.]", ".")

min_p_n <- minp_cors %>% 
  filter(column1 == "Peak", column2 == "MinPair_ProportionCorrect") %>% 
  pull(n) %>% 
  unique()

# unfam_peaks_avgs %>%  
#   filter(Study == "Age 3") %>% 
#   left_join(tp1) %>% 
#   ggplot() + 
#     aes(x = MinPair_ProportionCorrect, y = Peak) + 
#     geom_point(shape = 1) + 
#     geom_smooth(method = "lm") + 
#     labs(y = "Growth curve peak", caption = "Age 3")

# unfam_peaks_avgs %>%  
#   left_join(scores) %>% 
#   ggplot() + 
#     aes(x = EVT_Standard, y = Peak, color = Study) + 
#     geom_point(shape = 1) + 
#     geom_smooth(method = "lm") + 
#     labs(y = "Growth curve peak", caption = "Age 3")
# 

broomed_u <- m_u_new_fits_each %>% 
  tidyr::nest(-Study, -ResearchID) %>% 
  mutate(
    model = data %>% 
      purrr::map(~ lm(.posterior_value ~ ot1 + ot2 + ot3, .x)),
    results = purrr::map(model, broom::tidy))

features_u <- broomed_u %>% 
  select(-model, -data) %>% 
  tidyr::unnest(results) %>% 
  # select(.draw:estimate) %>% 
  select(Study:estimate) %>% 
  group_by(Study, ResearchID, term) %>% 
  summarise(estimate = mean(estimate)) %>% 
  group_by(Study, term) %>% 
   mutate(
    ntile = factor(ntile(estimate, 6)),
    num = fct_add_counts(ntile) %>% as.character()) 

# features_u %>%
#   ungroup() %>% 
#   filter(Study == "Age 3") %>% 
#   left_join(scores) %>% 
#   ggplot() + 
#     aes(x = MinPair_ProportionCorrect, y = estimate, color = term) + 
#     geom_point() + 
#     geom_smooth(method = "lm") + 
#     labs(y = "Growth curve feature", caption = "Age 3")
# 
# features_u %>%
#   ungroup() %>% 
#   filter(Study == "Age 3") %>%
#   left_join(scores) %>% 
#   filter(term == "(Intercept)") %>% 
#   lm(estimate ~ scale(EVT_Standard), .) %>% 
#   summary()

# unfam_peaks_avgs %>% 
#   left_join(scores) %>% 
#   filter(Study == "Age 3") %>% 
#   lm(Peak ~ scale(EVT_Standard), .) %>% 
#   summary()

# unfam_peaks_avgs %>% 
#   left_join(scores) %>% 
#   filter(Study == "Age 3") %>% 
#   lm(Peak ~ scale(MinPair_ProportionCorrect), .) %>% 
#   summary()

# Get 100 samples of peaks to model
to_model <- unfam_peaks %>% 
  sample_n_of(100, .draw) %>% 
  mutate(
    Study = convert_study_to_age(Study), 
    Peak = plogis(med)) %>% 
  left_join(scores) 

# Given a df with a EVT_Standard column, make a grid for ploting based on that
# df.
make_grid <- function(df) {
  modelr::data_grid(df, EVT_Standard = modelr::seq_range(EVT_Standard, 80))
}

# Fit 100 regressions
lines <- to_model %>% 
  tidyr::nest(-Study, -.draw) %>% 
  mutate(
    model = data %>% 
      purrr::map(~ lm(Peak ~ EVT_Standard, .x)),
    grid = data %>% purrr::map(make_grid),
    grid = purrr:::map2(grid, model, modelr::add_predictions)) %>% 
  select(Study, .draw, grid) %>% 
  tidyr::unnest()

# models <- to_model %>% 
#   tidyr::nest(-Study, -.draw) %>% 
#   mutate(
#     model = data %>% 
#       purrr::map(~ lm(Peak ~ EVT_Standard, .x)),
#     glance = model %>% purrr::map(broom::glance)) %>% 
#   select(Study, .draw, glance) %>% 
#   tidyr::unnest()

m_evt_age3 <- unfam_peaks_avgs %>% 
  left_join(scores) %>% 
  filter(Study == "Age 3") %>% 
  lm(Peak ~ scale(EVT_Standard, scale = FALSE), .)
summary(m_evt_age3)

# Small effect
delta_by_15 <- (coef(m_evt_age3)[2] * 15) %>% 
  printy::fmt_fix_digits(2) %>% 
  printy::fmt_leading_zero()

peak_evt_r_squared <- m_evt_age3 %>% 
  broom::glance() %>% 
  pull(r.squared) %>%
  printy::fmt_fix_digits(2) %>% 
  printy::fmt_leading_zero()

p_evt_peaks <- to_model %>% 
  filter(!is.na(EVT_Standard)) %>% 
  ggplot() + 
    aes(x = EVT_Standard, y = Peak, color = Study) + 
    stat_summary(fun.y = mean, geom = "point") + 
    stat_summary(fun.data = mean_se, geom = "linerange") + 
    geom_line(
      aes(y = pred, group = interaction(.draw, Study)), 
      data = lines, 
      alpha = .1)  +
    geom_text(
      aes(label = Study),
      data = data_frame(
        EVT_Standard = c(55, 156),
        Study = c("Age 3", "Age 4"),
        Peak = c(.44, .59)),
        size = 5, 
       family = "Lato Semibold") +
    scale_color_study() +
    guides(color = FALSE) +
    labs(
      x = "EVT-2 standard score",
      y = "Growth curve peak",
      title = "Vocabulary weakly predicts peaks at age 3",
      caption = "Lines: Regressions on 100 posterior samples of peaks")

# unfam_peaks_avgs %>% 
#   left_join(scores) %>% 
#   filter(Study == "Age 3") %>% 
#   lm(Peak ~ scale(EVT_Standard), .) %>% 
#   summary()

# 
# features_u %>%
#   ungroup() %>% 
#   filter(Study == "Age 5") %>%
#   left_join(scores) %>% 
#   filter(term == "ot3") %>% 
#   lm(estimate ~ scale(EVT_Standard), .) %>% 
#   summary()
#   
# gca_means <- broomed_u %>% 
#   select(-data, -model) %>% 
#   tidyr::unnest(results) %>% 
#   select(Study:estimate) 
# 
# gca_means %>% 
#   left_join(scores) %>% 
#   filter(Study == "Age 5") %>% 
#   split(.$term) %>% 
#   lapply(function(df) lm(estimate ~ EVT_Standard, df)) %>% 
#   lapply(summary)
# 
# gca_means %>% 
#   left_join(scores) %>% 
#   filter(Study == "Age 3") %>% 
#   split(.$term) %>% 
#   lapply(function(df) lm(estimate ~ MinPair_ProportionCorrect, df)) %>% 
#   lapply(summary)
```

I additionally asked whether any child-level factors predictors looking
behavior under these conditions. First, I asked whether performance on a
minimal pair discrimination task at age 3 predicted looking behavior at
age 3. The rationale here is the hypothesis that children with better
minimal pair discrimination may be especially sensitive to
mispronunciations. Proportion of items correct on the task did not
correlate with growth curve peaks, *r* = `r min_p_cor` with *n* =
`r min_p_n`, or with any other growth curve measures.


```{r plot-evt-peaks, out.width="50%", fig.width=4.25, fig.height=4}
p_evt_peaks
```

I also tested whether expressive vocabulary (EVT-2 standard score)
predicted performance in this condition. In this case, there were
significant effects at age 3 where a higher expressive vocabulary
predicted a higher growth curve peak and a higher average probability.
These effects, however, were very small. For example,
a 15-point increase in expressive vocabulary predicted an increase of
growth curve peak of `r delta_by_15`, *R*^2^ =
`r peak_evt_r_squared`---see Figure XX. Expressive vocabulary did not
predict any of the growth curve features at age 4 or at age 5.


**Summary**. When children look at the unfamiliar object and hear a
mispronunciation, they on average look to the familiar image that sounds
like the mispronunciation. Children are much more uncertain in this
condition, compared to the conditions whether appropriate referent is
more obvious. The only development changes observed were the increases
in average looking probability and peak looking probability at age 5.
There was a small effect of expressive vocabulary on looking probability
at age 3, but no other effects of vocabulary were observed.


## Familiar-initial trials

Preschoolers associate one-feature onset-mispronunciations with the
familiar word that matches the rime of the word. 

Figure XX shows the growth curve averages for trials starting on the
familiar image. Here the looking patterns show a rush into uncertainty.
At age 3 and age 4, the growth sharply decrease into chance
level-performance. Behaviorally, they are looking to both images
equally. One interpretation of this pattern is that the children are
making brief confirmatory looks to the novel image; they checking out
the novel image. But this cannot be right because the growth curve never
dips much below .5 (certainly not below .4). So there is more likely a
mix of behaviors, with children staying put on some trials and
considering the novel object on some trials.

```{r fam-initial-mp-trials, fig.width=5, fig.height=4, out.width="50%"}
f_newdata <- d_f %>% 
  distinct(Study, ResearchID, Time, ot1, ot2, ot3) %>% 
  mutate(Target = 0, Trials = 30)

m_f_new_fits_each <- augment_linpred(
  mp_fam, f_newdata, nsamples = 100, allow_new_levels = TRUE) %>% 
  mutate(Study = convert_study_to_age(Study)) 
  
m_f_new_fits <- m_f_new_fits_each %>% 
  group_by(Study, .draw, Time) %>% 
  summarise(Prop = mean(plogis(.posterior_value))) %>% 
  group_by(Study, .draw)

df_f_label <- tibble::tribble(
  ~Study, ~Time, ~Prop,
  "Age 3", 650, .80,
  "Age 4", 1000, .41,
  "Age 5", 1400, .66)

df_f_plotting <- d_f %>% 
  mutate(Study = convert_study_to_age(Study)) 

ggplot(df_f_plotting) + 
  aes(x = Time, y = Prop, color = Study) + 
  geom_hline(yintercept = .5, size = 2, color = "white") +
  stat_summary(fun.data = mean_se, geom = "pointrange") + 
  geom_line(aes(group = .group), data = m_f_new_fits, alpha = .05) +
  geom_text(
    aes(label = label),
    data = data_frame(
      Time = 410, 
      Prop = .93, 
      label = constants$note_mp_fam),
    size = 3, 
    hjust = 0,
    color = constants$col_off_black,
    family = "Lato") +
  geom_text(
    aes(label = Study),
    data = df_f_label,
    size = 5, 
    family = "Lato Semibold") +
  scale_color_study() + 
  expand_limits(y = .38) +
  guides(color = FALSE) +
  labs(
    x = constants$x_time,
    y = constants$y_prop_fam,
    caption = constants$cap_emp_and_draws)
```


* Age 3 and age 4 intercepts differ. Age 4 lower.
* Age 4 and age 5 intercepts differ. Age 5 higher.
* Captures differences in average value.

* Age 3 and age 4 linear slopes differ. Age 4 less negative.
* Age 4 and age 5 linear slopes differ. Age 5 less negative.
* Less of a linear trend downwards with age.
* 3 ish vs 2.5ish vs. 1.75 ish

* Age 4 and age 5 quadratic slopes differ. 
* Age 5 10% less than age 4, value moves closer to zero (2-ish vs. 1.75 ish).

* No credible differences for cubic time component.

```{r mp-fam-gca-features, eval = TRUE, fig.width = 7, fig.height = 3, out.width = "100%"}
test <- posterior_samples(mp_fam, pars = "^b_") %>% 
  transmute(
    b_Intercept_Age3 = b_Intercept,
    b_Intercept_Age4 = b_Intercept + b_StudyTimePoint2,
    b_Intercept_Age5 = b_Intercept + b_StudyTimePoint3,
    b_ot1_Age3 = b_ot1,
    b_ot1_Age4 = b_ot1 + `b_ot1:StudyTimePoint2`,
    b_ot1_Age5 = b_ot1 + `b_ot1:StudyTimePoint3`,
    b_ot2_Age3 = b_ot2,
    b_ot2_Age4 = b_ot2 + `b_ot2:StudyTimePoint2`,
    b_ot2_Age5 = b_ot2 + `b_ot2:StudyTimePoint3`,
    b_ot3_Age3 = b_ot3,
    b_ot3_Age4 = b_ot3 + `b_ot3:StudyTimePoint2`,
    b_ot3_Age5 = b_ot3 + `b_ot3:StudyTimePoint3`,
    b_Intercept_Prop_Age3 = plogis(b_Intercept_Age3),
    b_Intercept_Prop_Age4 = plogis(b_Intercept_Age4),
    b_Intercept_Prop_Age5 = plogis(b_Intercept_Age5),
    d_Intercept_Age4 = b_Intercept_Age4 - b_Intercept_Age3,
    d_Intercept_Age5 = b_Intercept_Age5 - b_Intercept_Age4,
    d_Intercept_Prop_Age4 = b_Intercept_Prop_Age4 - b_Intercept_Prop_Age3,
    d_Intercept_Prop_Age5 = b_Intercept_Prop_Age5 - b_Intercept_Prop_Age4,
    d_Intercept_Prop_Age5_3 = b_Intercept_Prop_Age5 - b_Intercept_Prop_Age3,
    d_ot1_Age4 = b_ot1_Age4 - b_ot1_Age3,
    d_ot1_Age5 = b_ot1_Age5 - b_ot1_Age4,
    d_ot2_Age4 = b_ot2_Age4 - b_ot2_Age3,
    d_ot2_Age5 = b_ot2_Age5 - b_ot2_Age4,
    d_ot3_Age4 = b_ot3_Age4 - b_ot3_Age3,
    d_ot3_Age5 = b_ot3_Age5 - b_ot3_Age4)
# 
# mcmc_intervals(test, regex_pars = "Intercept_A")
# mcmc_intervals(test, regex_pars = "Intercept_Prop")
# mcmc_intervals(test, regex_pars = "ot1_Age")
# mcmc_intervals(test, regex_pars = "ot2_Age")
# mcmc_intervals(test, regex_pars = "ot3_Age")
# mcmc_intervals(test, regex_pars = "Intercept_Prop")
# mcmc_intervals(test, regex_pars = "Age")

draws <- test %>% 
  tibble::rowid_to_column(".draw") %>% 
  sample_n(100) 

by_study <- df_f_plotting %>% 
  mutate(Intercept = 1) %>% 
  distinct(Study, Time, Intercept, ot1, ot2, ot3) %>% 
  tidyr::crossing(.draw = unique(draws$.draw)) %>% 
  left_join(draws) %>% 
  split(.$Study)

by_study$`Age 3`  <- by_study$`Age 3` %>% 
  mutate(
    b_Intercept = Intercept * b_Intercept_Age3,
    b_ot1  = ot1 * b_ot1_Age3,
    b_ot2  = ot2 * b_ot2_Age3,
    b_ot3  = ot3 * b_ot3_Age3)

by_study$`Age 4`  <- by_study$`Age 4` %>% 
  mutate(
    b_Intercept = Intercept * b_Intercept_Age4,
    b_ot1  = ot1 * b_ot1_Age4,
    b_ot2  = ot2 * b_ot2_Age4,
    b_ot3  = ot3 * b_ot3_Age4)

by_study$`Age 5`  <- by_study$`Age 5` %>% 
  mutate(
    b_Intercept = Intercept * b_Intercept_Age5,
    b_ot1  = ot1 * b_ot1_Age5,
    b_ot2  = ot2 * b_ot2_Age5,
    b_ot3  = ot3 * b_ot3_Age5)

feature_draws <- bind_rows(by_study) %>% 
  mutate(b_sum = b_Intercept + b_ot1 + b_ot2 + b_ot3) %>% 
  distinct(.draw, Study, Time, b_Intercept, b_ot1, b_ot2, b_ot3, b_sum) %>% 
  tidyr::gather("Feature", "Value", b_Intercept:b_sum) 


feature_draws %>% 
  # filter(Feature != "b_sum") %>% 
  mutate(
    Feature = factor(
      Feature, 
      levels = c("b_Intercept", "b_ot1", "b_ot2", "b_ot3", "b_sum"),
      labels = c("Intercept", "Time^1", "Time^2", "Time^3", "Total"))) %>% 
  group_by(Study, Feature, .draw) %>% 
  ggplot() + 
    aes(x = Time, y = Value, color = Study) + 
    geom_hline(color = "white", size = 1.5, yintercept = 0) + 
    geom_line(aes(group = .group), alpha = .05) + 
    facet_wrap("Feature", nrow = 1, labeller = label_parsed, scales = "free_y") +
    scale_color_study() + 
    guides(color = FALSE) +
    # guides(color = guide_legend(override.aes = list(alpha = 1))) + 
    geom_text(
      aes(label = Study, hjust = hjust),
      data = data_frame(
        Study = c("Age 3", "Age 4", "Age 5", "Age 5"),
        Time = c(650, 900, 300, 900),
        Value = c(1.1, .20, 0, 0),
        hjust = c(0, .5, 0, .5),
        Feature = c("Time^1", "Intercept", "Time^1", "Time^2")), 
      # hjust = 0, 
      size = 4,
      family = "Lato Semibold") + 
    expand_limits(y = range(by_study$`Age 3`$b_ot1)) +
  labs(
    x = constants$x_time, 
    y = "Growth curve feature (logits)",
    caption = "50 posterior samples of population-average (fixed) effects")
```

 
  - When we plot these features out, we see that they add up to make it
    so that the Age 4 curve dips down lowest and Age 5 does not dip as
    far down.
  - The developmental story, if any, is that children stick with the
    familiar object slightly more at age 5.

***

I asked whether growth curve "valleys" provided a meaningful feature for
this data. This value was defined as the median of the five smallest
proportions of a growth curve. It reflects the maximum degree to which
the novel image is considered as a referent for the mispronunciation.


```{r fam-peaks-by-age, fig.width=4, fig.height=3, out.width="50%"}
study_peak_counts <- fam_peaks %>%
  distinct(Study, ResearchID) %>%
  mutate(
    Study = Study %>% convert_study_to_age(),
    StudyCounts = Study %>% fct_add_counts()) %>%
  distinct(Study, StudyCounts)

x_levels <- setNames(
  as.character(study_peak_counts$StudyCounts), 
  as.character(study_peak_counts$Study))

fam_peaks %>% 
  mutate(
    Study = convert_study_to_age(Study),
    Peak = plogis(med)) %>% 
  group_by(Study, ResearchID) %>% 
  summarise_at(vars(Time, Peak), mean, na.rm = TRUE) %>% 
    ggplot() + 
      aes(x = Study, y = Peak) + 
      geom_hline(yintercept = .5, size = 2, color = "white") + 
      geom_boxplot(width = .4, fill = NA, outlier.alpha = 0) +
      geom_point(position = position_jitter(width = .2), alpha = .3, shape = 1) + 
      labs(
        title = "Growth curve valleys",
        subtitle = constants$note_mp_fam,
        x = NULL,
        y = NULL,
        caption = "Points: Participant posterior means.") + 
    scale_x_discrete(labels = x_levels) +
    theme(plot.subtitle = element_text(size = rel(.9)))

```

* There is considerable spread at each age. 
* The middle boxplot almost stretches perfectly from 0 to 1.
* There is probably a few different behaviors being captured here.
* That said, the median is closer to .5 at age 5 which matches how the 
  growth curves looked.

What curve features capture different looking behaviors?

```{r diffs, width = 6, height = 6, out.width="80%"}
peak_groups <- fam_peaks %>% 
  mutate(
    Study = convert_study_to_age(Study),
    Peak = plogis(med)) %>% 
  group_by(Study, ResearchID) %>% 
  summarise_at(vars(Time, Peak), mean, na.rm = TRUE) %>% 
  mutate(
    ntile = factor(ntile(Peak, 6)),
    num = fct_add_counts(ntile) %>% as.character()) %>% 
  distinct(Study, ResearchID, Peak, ntile, num)

m_f_new_fits_each %>% 
  sample_n_of(10, .draw) %>% 
  left_join(peak_groups) %>% 
  filter(Study == "Age 3") %>% 
  group_by(ResearchID, Study, .draw) %>% 
  ggplot() + 
    aes(x = Time, y = plogis(.posterior_value), color = ResearchID) + 
    geom_line(aes(group = .group), alpha = .1) + 
    facet_wrap("num") + 
    guides(color = FALSE) + 
    labs(
      title = "Age 3 children binned into 6-tiles by min value",
      caption = "10 posterior samples per child")

with_peaks <- fam_peaks %>% 
  mutate(
    Study = convert_study_to_age(Study),
    Peak = plogis(med)) %>% 
  group_by(Study, ResearchID) %>% 
  summarise_at(vars(Time, Peak), mean, na.rm = TRUE) %>% 
  rename(PeakTime = Time) %>% 
  ungroup() %>% 
  left_join(m_f_new_fits_each) %>% 
  group_by(Study, ResearchID, .draw) %>% 
  filter(Time >= PeakTime) %>% 
  top_n(5, .posterior_value) %>% 
  summarise(
    Peak = mean(Peak),
    EndPeak = plogis(median(.posterior_value)),
    Diff = EndPeak - Peak) %>% 
  group_by(Study, ResearchID) %>% 
  summarise_at(vars(Peak, EndPeak, Diff), mean, na.rm = TRUE) %>% 
   mutate(
    ntile = factor(ntile(Diff, 6)),
    num = fct_add_counts(ntile) %>% as.character())

m_f_new_fits_each %>% 
  sample_n_of(10, .draw) %>% 
  left_join(with_peaks) %>% 
  filter(Study == "Age 3") %>% 
  group_by(ResearchID, Study, .draw) %>% 
  ggplot() + 
    aes(x = Time, y = plogis(.posterior_value), color = ResearchID) + 
    geom_line(aes(group = .group), alpha = .1) + 
    facet_wrap("num") + 
    guides(color = FALSE) + 
    labs(
      title = "Age 3 children binned into 6-tiles by rise after min value",
      caption = "10 posterior samples per child")

deltas <- m_f_new_fits_each %>% 
  sample_n_of(10, .draw) %>% 
  mutate(Half = Time <= median(Time)) %>% 
  group_by(.draw, Study, ResearchID) %>% 
  summarise(
    # Halfy = ifelse(Half, min(.posterior_value), max(.posterior_value)),
    HalfMin = min(ifelse(Half, plogis(.posterior_value), 1000)),
    HalfMax = max(ifelse(!Half, plogis(.posterior_value), -1000)),
    Delta = HalfMax - HalfMin) %>% 
  group_by(Study, ResearchID) %>% 
  summarise_at(vars(HalfMin, HalfMax, Delta), mean, na.rm = TRUE) %>% 
   mutate(
    ntile = factor(ntile(Delta, 6)),
    num = fct_add_counts(ntile) %>% as.character())
  
m_f_new_fits_each %>% 
  sample_n_of(10, .draw) %>% 
  left_join(deltas) %>% 
  filter(Study == "Age 3") %>% 
  group_by(ResearchID, Study, .draw) %>% 
  ggplot() + 
    aes(x = Time, y = plogis(.posterior_value), color = ResearchID) + 
    geom_line(aes(group = .group), alpha = .1) + 
    facet_wrap("num") + 
    guides(color = FALSE) + 
    labs(
      title = "Age 3 children binned into 6-tiles by differences",
      subtitle = "Difference = second half max - first half min",
      caption = "10 posterior samples per child")

# broomed <- m_f_new_fits_each %>% 
#   sample_n_of(10, .draw) %>% 
#   tidyr::nest(-Study, -ResearchID, -.draw) %>% 
#   mutate(
#     model = data %>% 
#       purrr::map(~ lm(.posterior_value ~ ot1 + ot2 + ot3, .x)),
#     results = purrr::map(model, broom::tidy))

broomed2 <- m_f_new_fits_each %>% 
  tidyr::nest(-Study, -ResearchID) %>% 
  mutate(
    model = data %>% 
      purrr::map(~ lm(plogis(.posterior_value) ~ ot1 + ot2 + ot3, .x)),
    results = purrr::map(model, broom::tidy))

# bowls <- broomed %>% 
bowls <- broomed2 %>% 
  select(-model, -data) %>% 
  tidyr::unnest(results) %>% 
  # select(.draw:estimate) %>% 
  select(Study:estimate) %>% 
  group_by(Study, ResearchID, term) %>% 
  summarise(estimate = mean(estimate)) %>% 
  group_by(Study, term) %>% 
   mutate(
    ntile = factor(ntile(estimate, 6)),
    num = fct_add_counts(ntile) %>% as.character()) 


m_f_new_fits_each %>% 
  sample_n_of(10, .draw) %>% 
  left_join(bowls %>% filter(term == "ot2")) %>% 
  filter(Study == "Age 3") %>% 
  group_by(ResearchID, Study, .draw) %>% 
  ggplot() + 
    aes(x = Time, y = plogis(.posterior_value), color = ResearchID) + 
    geom_line(aes(group = .group), alpha = .1) + 
    facet_wrap("num") + 
    guides(color = FALSE) + 
    labs(
      title = "Age 3 children binned into 6-tiles by quadratic trend",
      caption = "10 posterior samples per child")
```


```{r}
scores <- readr::read_csv("./data-raw/test_scores.csv") %>% 
  mutate(
    MinPair_ProportionCorrect = ifelse(
      MinPair_ProportionCorrect < .2, NA, MinPair_ProportionCorrect))
tp1 <- scores %>% filter(Study == "TimePoint1")
tp2 <- scores %>% filter(Study == "TimePoint2")
tp3 <- scores %>% filter(Study == "TimePoint3")

bowls %>%
  ungroup() %>% 
  filter(Study == "Age 3") %>% 
  left_join(scores %>% mutate(Study = convert_study_to_age(Study))) %>% 
  ggplot() + 
    aes(x = MinPair_ProportionCorrect, y = estimate, color = term) + 
    geom_point() + 
    geom_smooth(method = "lm") + 
    labs(y = "Growth curve feature", caption = "Age 3")


with_peaks %>%
  ungroup() %>% 
  filter(Study == "Age 3") %>% 
  left_join(scores %>% mutate(Study = convert_study_to_age(Study))) %>% 
  ggplot() + 
    aes(x = MinPair_ProportionCorrect, y = Peak) + 
    geom_point() + 
    geom_smooth(method = "lm") + 
    labs(y = "Growth curve valley", caption = "Age 3")

deltas %>%
  ungroup() %>% 
  filter(Study == "Age 3") %>% 
  left_join(scores %>% mutate(Study = convert_study_to_age(Study))) %>% 
  ggplot() + 
    aes(x = MinPair_ProportionCorrect, y = Delta) + 
    geom_point() + 
    geom_smooth(method = "lm") + 
    labs(y = "second half max - first half min", caption = "Age 3")

with_peaks %>%
  ungroup() %>% 
  filter(Study == "Age 3") %>% 
  left_join(scores %>% mutate(Study = convert_study_to_age(Study))) %>% 
  ggplot() + 
    aes(x = MinPair_ProportionCorrect, y = Peak) + 
    geom_point() + 
    geom_smooth(method = "lm") + 
   labs(y = "Growth curve valley", caption = "Age 3")

  


with_peaks %>%
  ungroup() %>% 
  # filter(Study == "Age 3") %>% 
  left_join(scores %>% mutate(Study = convert_study_to_age(Study))) %>% 
  ggplot() + 
    aes(x = EVT_Standard, y = Peak, color = Study) + 
    geom_point() + 
    geom_smooth(method = "lm") + 
    labs(y = "Growth curve valley")

with_peaks %>%
  ungroup() %>% 
  # filter(Study == "Age 3") %>% 
  left_join(scores %>% mutate(Study = convert_study_to_age(Study))) %>% 
  ggplot() + 
    aes(x = EVT_GSV, y = Peak, color = Study) + 
    geom_point() + 
    geom_smooth(method = "lm") + 
    labs(y = "Growth curve valley")

with_peaks %>%
  ungroup() %>% 
  filter(Study != "Age 5") %>%
  left_join(scores %>% mutate(Study = convert_study_to_age(Study))) %>% 
  ggplot() + 
    aes(x = PPVT_GSV, y = Peak, color = Study) + 
    geom_point() + 
    geom_smooth(method = "lm") + 
    labs(y = "Growth curve valley")

with_peaks %>%
  ungroup() %>% 
  # filter(Study == "Age 3") %>% 
  left_join(scores %>% mutate(Study = convert_study_to_age(Study))) %>% 
  ggplot() + 
    aes(x = PPVT_GSV, y = Peak, color = Study) + 
    geom_point() + 
    geom_smooth(method = "lm") + 
    labs(y = "Growth curve valley")

  




# w_evt <- scores %>% 
#   filter(Study != "TimePoint2") %>% 
#   select(ResearchID, Study, EVT_Standard) %>% 
#   tidyr::spread(Study, EVT_Standard) %>% 
#   inner_join(do_it_1 %>% filter(Study == "TimePoint1")) %>% 
#   modelr::add_residuals(
#     lm(TimePoint3 ~ TimePoint1, .), 
#     "EVT_Residualized")
```



```{r, eval}

```


## Discussion

  - For the first set of analyses, they reliably and more reliably with
    age look to the familiar image.
  - There is a definite penalty to the mispronunciation when we compare
    against real word or nonword peaks.
  - Unlike those conditions which started to show ceiling effects at
    age 4, children are much more uncertain here.
  - In terms of lexical processing, the syllable onset leads them down a
    garden path. They have to hear more of the word in order to
    associate the mispronunciation with the target. This is a bit like
    processing a rime word.
  - The development story is that they can use the rest of the word more
    effectively to associate the MP with the familiar image. This would
    predict that children become more sensitive to rime-based lexical
    competitors during the preschool years.
  - But there is no effect of expressive vocabulary here, especially at older ages.
  - So they are sensitive but they become more accommodating of the
    mispronounced version.
  


  - For second set of analyses, there is no one clear strategy for
    referent selection. We see a few different patterns among children.
    Some stay put. Some always switch. Some do both.
  - The growth curve averages rush to .5, which is equal looks to both
    images, which is maximum uncertainty.
  - The age 5 curve doesn't dip as far, so they are slightly more likely
    to stay put.
  - These sets of analyses mainly demonstrate that when children start
    on a familiar image and hear a mispronunciation, they have a few
    options for how to proceed.
  - This also shows a possible decoupling between lexical processing and referent selection. It is unlikely that children heard the mispronunciations differently in these trials, but rather the responded differently.



