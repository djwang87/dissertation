lpred_lm <-
  structure(
    list(
      .draw = structure(
        c(
          2L,
          2L,
          2L,
          2L,
          2L,
          2L,
          2L,
          2L,
          2L,
          2L,
          2L,
          2L,
          2L,
          2L,
          2L,
          2L,
          2L,
          2L,
          2L,
          2L,
          2L,
          2L,
          2L,
          2L,
          2L,
          2L
        ),
        .Label = c("3", "2", "1"),
        class = "factor"
      ),
      auc = c(
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789,
        0.0495676257357789
      ),
      slope = c(
        2.55006207505727,
        2.55006207505727,
        2.55006207505727,
        2.55006207505727,
        2.55006207505727,
        2.55006207505727,
        2.55006207505727,
        2.55006207505727,
        2.55006207505727,
        2.55006207505727,
        2.55006207505727,
        2.55006207505727,
        2.55006207505727,
        2.55006207505727,
        2.55006207505727,
        2.55006207505727,
        2.55006207505727,
        2.55006207505727,
        2.55006207505727,
        2.55006207505727,
        2.55006207505727,
        2.55006207505727,
        2.55006207505727,
        2.55006207505727,
        2.55006207505727,
        2.55006207505727
      ),
      time2 = c(
        -0.460271778359737,
        -0.460271778359737,
        -0.460271778359737,-0.460271778359737,
        -0.460271778359737,
        -0.460271778359737,
        -0.460271778359737,-0.460271778359737,
        -0.460271778359737,
        -0.460271778359737,
        -0.460271778359737,-0.460271778359737,
        -0.460271778359737,
        -0.460271778359737,
        -0.460271778359737,-0.460271778359737,
        -0.460271778359737,
        -0.460271778359737,
        -0.460271778359737,-0.460271778359737,
        -0.460271778359737,
        -0.460271778359737,
        -0.460271778359737,-0.460271778359737,
        -0.460271778359737,
        -0.460271778359737
      ),
      time3 = c(
        -0.556241082483786,
        -0.556241082483786,
        -0.556241082483786,-0.556241082483786,
        -0.556241082483786,
        -0.556241082483786,-0.556241082483786,
        -0.556241082483786,
        -0.556241082483786,-0.556241082483786,
        -0.556241082483786,
        -0.556241082483786,-0.556241082483786,
        -0.556241082483786,
        -0.556241082483786,-0.556241082483786,
        -0.556241082483786,
        -0.556241082483786,-0.556241082483786,
        -0.556241082483786,
        -0.556241082483786,-0.556241082483786,
        -0.556241082483786,
        -0.556241082483786,-0.556241082483786,
        -0.556241082483786
      ),
      .observation = 1:26,
      .posterior_value = c(
        -1.1502503126257,
        -1.15036571693142,-1.12095461141783,
        -1.06506289258884,
        -0.985736456948367,-0.886021201000312,
        -0.768963021248587,
        -0.6376078141971,-0.495001476349762,
        -0.34418990421048,
        -0.188218994283164,-0.0301346430717225,
        0.127017252919935,
        0.280190797187899,
        0.42634009322826,
        0.56241924453711,
        0.68538235461054,
        0.79218352694464,
        0.8797768650355,
        0.945116472379214,
        0.98515645247187,
        0.99685090880956,
        0.977153944888375,
        0.923019664204405,
        0.831402170253742,
        0.699255566532477
      ),
      Study = c(
        "TimePoint2",
        "TimePoint2",
        "TimePoint2",
        "TimePoint2",
        "TimePoint2",
        "TimePoint2",
        "TimePoint2",
        "TimePoint2",
        "TimePoint2",
        "TimePoint2",
        "TimePoint2",
        "TimePoint2",
        "TimePoint2",
        "TimePoint2",
        "TimePoint2",
        "TimePoint2",
        "TimePoint2",
        "TimePoint2",
        "TimePoint2",
        "TimePoint2",
        "TimePoint2",
        "TimePoint2",
        "TimePoint2",
        "TimePoint2",
        "TimePoint2",
        "TimePoint2"
      ),
      Time = c(
        250,
        300,
        350,
        400,
        450,
        500,
        550,
        600,
        650,
        700,
        750,
        800,
        850,
        900,
        950,
        1000,
        1050,
        1100,
        1150,
        1200,
        1250,
        1300,
        1350,
        1400,
        1450,
        1500
      ),
      ot1 = c(
        -0.5,
        -0.46,
        -0.42,-0.38,
        -0.34,
        -0.3,
        -0.26,
        -0.22,
        -0.18,
        -0.14,
        -0.1,
        -0.06,-0.02,
        0.02,
        0.06,
        0.1,
        0.14,
        0.18,
        0.22,
        0.26,
        0.3,
        0.34,
        0.38,
        0.42,
        0.46,
        0.5
      ),
      ot2 = c(
        0.597614304667197,
        0.454186871547069,
        0.322711724520286,
        0.203188863586847,
        0.0956182887467514,-1.04357192409317e-16,
        -0.0836660026534077,
        -0.155379719213471,-0.215141149680191,
        -0.262950294053567,
        -0.298807152333598,-0.322711724520286,
        -0.33466401061363,
        -0.33466401061363,-0.322711724520286,
        -0.298807152333598,
        -0.262950294053567,-0.215141149680191,
        -0.155379719213471,
        -0.0836660026534076,-1.73928654015529e-17,
        0.0956182887467514,
        0.203188863586847,
        0.322711724520286,
        0.45418687154707,
        0.597614304667197
      ),
      ot3 = c(
        -0.629723529922403,
        -0.327456235559649,
        -0.088161294189136,
        0.0936371509710706,
        0.223414956702905,
        0.3066479797883,
        0.348812077009192,
        0.355383105147512,
        0.331836920985197,
        0.283649381304178,
        0.21629634288639,
        0.135253662513768,
        0.045997196968245,
        -0.0459971969682452,-0.135253662513768,
        -0.216296342886391,
        -0.283649381304178,-0.331836920985197,
        -0.355383105147512,
        -0.348812077009192,-0.3066479797883,
        -0.223414956702905,
        -0.0936371509710702,
        0.0881612941891364,
        0.327456235559649,
        0.629723529922403
      ),
      ResearchID = c(
        "NEW",
        "NEW",
        "NEW",
        "NEW",
        "NEW",
        "NEW",
        "NEW",
        "NEW",
        "NEW",
        "NEW",
        "NEW",
        "NEW",
        "NEW",
        "NEW",
        "NEW",
        "NEW",
        "NEW",
        "NEW",
        "NEW",
        "NEW",
        "NEW",
        "NEW",
        "NEW",
        "NEW",
        "NEW",
        "NEW"
      ),
      Primary = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
      Others = c(0,
                 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                 0, 0, 0, 0, 0, 0)
    ),
    class = c("tbl_df", "tbl", "data.frame"),
    row.names = c(NA,-26L)
  )

constants <- list(
  x_time = "Time after target onset [ms]",
  y_logodds_target = "Log-odds looking to target",
  y_prop_target = "Proportion looks to target",
  y_prop_fam = "Proportion looks to familiar image",
  y_pred_elog_phon = "Predicted emp. log-odds [Phon.]",
  y_elog_phon = "Emp. log-odds(Phon. vs. Unrelated)",
  y_elog_semy = "Emp. log-odds(Sem. vs. Unrelated)",
  y_elog_diff_phon = "Difference in emp. log-odds [Phon.]",
  y_elog_diff_semy = "Difference in emp. log-odds [Sem.]",
  lab_study = "Study",
  col_blue_highlight = "#0074D9",
  col_off_black = "#111111",
  col_infobox_blue = "#EEF7FA",
  col_infobox_plot_bg = "#E5EAEF",
  cap_median_90_50 = "Posterior median with 90% and 50% intervals",
  cap_90_50 = "90% and 50% intervals",
  cap_mean_95 = "Fitted means with 95% interval",
  cap_diff_95 = "Estimated difference with 95% interval"
)




library(dplyr)
library(ggplot2)
stopifnot(package_version("2.2.1") < packageVersion("ggplot2"))
library(extrafont)
extrafont::font_import()
library(patchwork)

theme_poster <- theme_grey(base_size = 14, base_family = "Lato")

p1 <- ggplot(lpred_lm) +
  aes(x = ot1, y = .posterior_value, group = .draw) +
  geom_line(linetype = "dashed", color = constants$col_off_black) +
  geom_point(
    data = lpred_lm %>% group_by(.draw) %>% top_n(5, .posterior_value),
    size = 2, color = constants$col_off_black) +
  geom_hline(
    aes(yintercept = .posterior_value),
    data = lpred_lm %>%
      group_by(.draw) %>%
      top_n(5, .posterior_value) %>%
      summarise(.posterior_value = median(.posterior_value)),
    size = .75,
    color = constants$col_blue_highlight) +
  annotate(
    geom = "text", x = -.20, y = -.66,  color = constants$col_off_black,
    label = "growth curve estimated\nfor each child x study", family = "Lato",
    size = 3.5, vjust = 1, hjust = 0) +
  annotate(
    geom = "text", x = -.50, y = .9,  color = constants$col_blue_highlight,
    label = "curve feature", family = "Lato",
    size = 3.5, vjust = 1, hjust = 0) +
  labs(
    x = NULL,
    y = constants$y_logodds_target,
    title = "Peak probability") +
  theme_poster +
  theme(
    strip.text = element_blank(),
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.title.y = element_text(hjust = 1),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank())


p2 <- ggplot(lpred_lm) +
  aes(x = ot1, y = .posterior_value, group = .draw) +
  geom_line(linetype = "dashed", color = constants$col_off_black) +
  geom_hline(
    aes(yintercept = auc),
    color = constants$col_blue_highlight,
    size = .75) +
  labs(
    x = NULL,
    y = constants$y_logodds_target,
    title = "Average probability") +
  theme_poster +
  theme(
    strip.text = element_blank(),
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank())


p3 <- ggplot(lpred_lm) +
  aes(x = ot1, y = .posterior_value, group = .draw) +
  geom_line(linetype = "dashed", color = constants$col_off_black) +
  geom_abline(
    aes(slope = slope, intercept = auc),
    color = constants$col_blue_highlight,
    size = .75) +
  labs(
    x = NULL,
    y = NULL,
    title = "Linear trend") +
  theme_poster +
  theme(
    strip.text = element_blank(),
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.title.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank())




p4 <- ggplot(lpred_lm) +
  aes(x = ot1, y = .posterior_value, group = .draw) +
  geom_line(linetype = "dashed", color = constants$col_off_black) +
  geom_line(
    aes(y = ot2 * time2 + auc),
    color = constants$col_blue_highlight,
    size = .75) +
  labs(
    x = NULL,
    y = NULL,
    title = "Quadratic trend") +
  theme_poster +
  theme(
    strip.text = element_blank(),
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.title.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank())

p5 <- ggplot(lpred_lm) +
  aes(x = ot1, y = .posterior_value, group = .draw) +
  geom_line(
    linetype = "dashed", color = constants$col_off_black,
    data = lpred_lm %>% filter(.posterior_value <= -.97)) +
  geom_line(
    linetype = "dashed", color = constants$col_off_black,
    data = lpred_lm %>% filter(-.68 <= .posterior_value)) +
  geom_line(
    aes(y = ot3 * time3 + auc),
    color = constants$col_blue_highlight,
    size = .75) +
  labs(
    x = constants$x_time,
    y = NULL,
    title = "Cubic trend") +
  theme_poster +
  theme(
    strip.text = element_blank(),
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.title.x = element_text(hjust = 1),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank()) +
  annotate(
    geom = "text", x = -1.25, y = -.66,  color = constants$col_off_black,
    label = "(These two features capture the curve shape\nand tend not to be behaviorally meaningful.)",
    family = "Lato",
    size = 3.5, vjust = 1, hjust = 0)  +
  coord_cartesian(clip = "off", xlim = c(-.5, .5))

library(patchwork)
p1 + p2 + p3 + p4 + p5 + plot_layout(nrow = 1)
tjmisc::ggpreview(width = 12, height = 3.5, dpi = 600)

